<!DOCTYPE html>
<html class="no-js">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
    <title>poweb</title>
    <link href="images/logo-icon.svg" rel="icon" type="image/svg">
    <script>var pathToRoot = "";</script>
    <script>document.documentElement.classList.replace("no-js","js");</script>
    <script>const storage = localStorage.getItem("dokka-dark-mode")
    if (storage == null) {
        const osDarkSchemePreferred = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
        if (osDarkSchemePreferred === true) {
            document.getElementsByTagName("html")[0].classList.add("theme-dark")
        }
    } else {
        const savedDarkMode = JSON.parse(storage)
        if(savedDarkMode === true) {
            document.getElementsByTagName("html")[0].classList.add("theme-dark")
        }
    }
    </script>
<script type="text/javascript" src="https://unpkg.com/kotlin-playground@1/dist/playground.min.js" async="async"></script>
<script type="text/javascript" src="scripts/sourceset_dependencies.js" async="async"></script>
<link href="styles/style.css" rel="Stylesheet">
<link href="styles/main.css" rel="Stylesheet">
<link href="styles/prism.css" rel="Stylesheet">
<link href="styles/logo-styles.css" rel="Stylesheet">
<link href="styles/font-jb-sans-auto.css" rel="Stylesheet">
<script type="text/javascript" src="scripts/clipboard.js" async="async"></script>
<script type="text/javascript" src="scripts/navigation-loader.js" async="async"></script>
<script type="text/javascript" src="scripts/platform-content-handler.js" async="async"></script>
<script type="text/javascript" src="scripts/main.js" defer="defer"></script>
<script type="text/javascript" src="scripts/prism.js" async="async"></script>
<script type="text/javascript" src="scripts/symbol-parameters-wrapper_deferred.js" defer="defer"></script>
</head>
<body>
    <div class="root">
<nav class="navigation" id="navigation-wrapper">
    <div class="navigation--inner">
        <div class="navigation-title">
            <button class="menu-toggle" id="menu-toggle" type="button">toggle menu</button>
            <div class="library-name">
                    <a class="library-name--link" href="index.html">
                            poweb
                    </a>
            </div>
            <div class="library-version">
1.0.0a1            </div>
        </div>
        <div class="filter-section" id="filter-section">
                <button class="platform-tag platform-selector jvm-like" data-active="" data-filter=":dokkaHtml/main">jvm</button>
        </div>
    </div>
    <div class="navigation-controls">
        <button class="navigation-controls--btn navigation-controls--theme" id="theme-toggle-button" type="button">switch theme</button>
        <div class="navigation-controls--btn navigation-controls--search" id="searchBar" role="button">search in API</div>
    </div>
</nav>
        <div id="container">
            <div class="sidebar" id="leftColumn">
                <div class="sidebar--inner" id="sideMenu"></div>
            </div>
            <div id="main">
<div class="main-content" id="content" pageIds="poweb::////PointingToDeclaration//769193423">
  <div class="breadcrumbs"></div>
  <div class="cover ">
    <h1 class="cover"><span><span>poweb</span></span></h1>
    <div class="platform-hinted UnderCoverText" data-platform-hinted="data-platform-hinted"><div class="content sourceset-dependent-content" data-active="" data-togglable=":dokkaHtml/main"><p class="paragraph">This is the JVM implementation of the <a href="https://specs.relaynet.network/RS-016">Relaynet PoWeb binding</a>, meant to be used on Android 5+ and Java 8+ platforms.</p><h2 class=""> Install</h2><p class="paragraph">This package can be retrieved from <a href="https://bintray.com/relaycorp/maven/tech.relaycorp.poweb">JCenter</a>. For example, using the Gradle Groovy DSL:</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">implementation 'tech.relaycorp:poweb:1.5.13'</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><h2 class=""> Usage</h2><p class="paragraph">The first step is to generate and store the key pair that your private node will use on the network:</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">val keyPair = generateRSAKeyPair()<br>securelyStorePrivateKey(keyPair.private)</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><p class="paragraph">Next, initialize the client, which depends on the nature of your software:</p><ul><li><p class="paragraph">If it is a Relaynet-compatible app, you'll want to use <a href="poweb/tech.relaycorp.poweb/-po-web-client/-companion/init-local.html">tech.relaycorp.poweb.PoWebClient.initLocal</a>; e.g.:</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">val client = PoWebClient.initLocal()</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><p class="paragraph">Note: If you're building a Relaynet-compatible app for Android, use <a href="https://github.com/relaycorp/relaynet-endpoint-android">the endpoint library</a> instead as it offers a high-level interface to interact with the Android Gateway.</p></li><li><p class="paragraph">If it's a private gateway, like the <a href="https://github.com/relaycorp/relaynet-gateway-android">Android Gateway</a>, you'll want to connect to the public gateway using <a href="poweb/tech.relaycorp.poweb/-po-web-client/-companion/init-remote.html">tech.relaycorp.poweb.PoWebClient.initRemote</a>; e.g.:</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">val client = PoWebClient.initRemote(&quot;poweb-frankfurt.relaycorp.cloud&quot;)</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div></li></ul><h3 class=""> Private node registration</h3><p class="paragraph">Per the PoWeb spec, before your private endpoint can exchange parcels with its gateway, it must register with it in order to get a certificate.</p><p class="paragraph">The registration step is preceded by a pre-registration that depends on the type of server you're connecting to. If you're connecting to a private gateway, the pre-registration process is determined by the private gateway implementation; for example, as of this writing, the Android Gateway uses a bound service. If you're connecting to a public gateway, to can pre-register using <a href="poweb/tech.relaycorp.poweb/-po-web-client/pre-register-node.html">tech.relaycorp.poweb.PoWebClient.preRegisterNode</a>; e.g.:</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">val registrationRequest = client.preRegisterNode(keyPair.public)</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><p class="paragraph">Once pre-registration is complete, you can complete the registration by passing the registration request <code class="lang-kotlin">registrationRequest</code> to <a href="poweb/tech.relaycorp.poweb/-po-web-client/register-node.html">tech.relaycorp.poweb.PoWebClient.registerNode</a>. This registration request contains the registration authorization created by the server. For example, you may complete the registration as follows:</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">val requestSerialized = registrationRequest.serialize(keyPair.private)<br>val registration = client.registerNode(requestSerialized)</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><p class="paragraph">Finally, you can now store the certificates contained in the <a href="https://docs.relaycorp.tech/relaynet-jvm/api/relaynet/tech.relaycorp.relaynet.messages.control/-private-node-registration/index.html">registration</a>.</p><h3 class=""> Request signing</h3><p class="paragraph">Now that your private node is registered with its gateway, you have to use the certificate issued by its gateway and its corresponding private key to sign requests to exchange parcels. You can do so by initializing a <i>signer</i> and passing it to such requests; e.g.:</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">val signer = Signer(registration.privateNodeCertificate, keyPair.private)</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><h3 class=""> Delivering parcels</h3><p class="paragraph">Use <a href="poweb/tech.relaycorp.poweb/-po-web-client/deliver-parcel.html">tech.relaycorp.poweb.PoWebClient.deliverParcel</a> to deliver parcels to the gateway; e.g.:</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">client.deliverParcel(parcelSerialized, signer)</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><h3 class=""> Collecting parcels</h3><p class="paragraph">Use <a href="poweb/tech.relaycorp.poweb/-po-web-client/collect-parcels.html">tech.relaycorp.poweb.PoWebClient.collectParcels</a> to collect parcels from the gateway; e.g.:</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">client.collectParcels(arrayOf(signer)).map {<br>    val parcel = it.deserializeAndValidateParcel()<br>    println(&quot;Parcel ${parcel.id} bound for ${parcel.recipientAddress} is valid&quot;)<br>    storeParcel(it.parcelSerialized)<br>    it.ack()<br>}</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><h3 class=""> Closing the connection</h3><p class="paragraph">Make sure to close the connection by calling <a href="poweb/tech.relaycorp.poweb/-po-web-client/close.html">tech.relaycorp.poweb.PoWebClient.close</a> when you're done, or wrapping the statements using the client with a <code class="lang-kotlin">.use</code> block as illustrated below:</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">client.use {<br>    client.deliverParcel(parcelSerialized, signer)<br>}</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div></div></div>
  </div>
  <h2 class="">Packages</h2>
  <div class="table"><a data-name="1170287628%2FPackages%2F769193423" anchor-label="tech.relaycorp.poweb" id="1170287628%2FPackages%2F769193423" data-filterable-set=":dokkaHtml/main"></a>
    <div class="table-row" data-filterable-current=":dokkaHtml/main" data-filterable-set=":dokkaHtml/main">
      <div>
        <div class="main-subrow ">
          <div class=""><span class="inline-flex">
              <div><a href="poweb/tech.relaycorp.poweb/index.html">tech.relaycorp.poweb</a></div>
<span class="anchor-wrapper"><span class="anchor-icon" pointing-to="1170287628%2FPackages%2F769193423"></span>
                <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
              </span></span></div>
          <div class="pull-right">
            <div class="platform-tags no-gutters">
              <div class="platform-tag jvm-like">jvm</div>
            </div>
          </div>
        </div>
        <div><span class="brief-comment"><a data-name="1170287628%2FPackages%2F769193423" anchor-label="tech.relaycorp.poweb" id="1170287628%2FPackages%2F769193423" data-filterable-set=":dokkaHtml/main"></a>
            <p class="paragraph">This package contains the PoWeb client.</p>
          </span></div>
      </div>
    </div>
  </div>
</div>
      <div class="footer">
        <span class="go-to-top-icon"><a href="#content" id="go-to-top-link"></a></span><span>© 2024 Copyright</span><span
                class="pull-right"><span>Generated by </span><a
                href="https://github.com/Kotlin/dokka"><span>dokka</span><span class="padded-icon"></span></a></span>
      </div>
            </div>
        </div>
    </div>
</body>
</html>
