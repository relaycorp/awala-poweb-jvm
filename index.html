<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
    <title>poweb</title>
    <link href="images/logo-icon.svg" rel="icon" type="image/svg">
    <script>var pathToRoot = "";</script>
    <script type="text/javascript" src="scripts/sourceset_dependencies.js" async="async"></script>
    <link href="styles/style.css" rel="Stylesheet">
    <link href="styles/logo-styles.css" rel="Stylesheet">
    <link href="styles/jetbrains-mono.css" rel="Stylesheet">
    <link href="styles/main.css" rel="Stylesheet">
    <script type="text/javascript" src="scripts/clipboard.js" async="async"></script>
    <script type="text/javascript" src="scripts/navigation-loader.js" async="async"></script>
    <script type="text/javascript" src="scripts/platform-content-handler.js" async="async"></script>
    <script type="text/javascript" src="scripts/main.js" async="async"></script>
  </head>
  <body>
    <div id="container">
      <div id="leftColumn">
        <div id="logo"></div>
        <div id="paneSearch"></div>
        <div id="sideMenu"></div>
      </div>
      <div id="main">
        <div id="leftToggler"><span class="icon-toggler"></span></div>
        <script type="text/javascript" src="scripts/pages.js"></script>
        <script type="text/javascript" src="scripts/main.js"></script>
        <div class="main-content" id="content" pageIds="////PointingToDeclaration//-1573829515">
          <div class="navigation-wrapper" id="navigation-wrapper">
            <div class="breadcrumbs"><a href="index.html">poweb</a></div>
            <div class="pull-right d-flex">
              <div id="searchBar"></div>
            </div>
          </div>
          <div class="cover ">
            <h1 class="cover"><span>poweb</span></h1>
            <div class="platform-hinted UnderCoverText" data-platform-hinted="data-platform-hinted"><div class="content sourceset-depenent-content" data-active="" data-togglable=":dokkaHtml/main"><p class="paragraph">This is the JVM implementation of the <a href="https://specs.relaynet.network/RS-016">Relaynet PoWeb binding</a>, meant to be used on Android 5+ and Java 8+ platforms.</p><h2 class=""> Install</h2><p class="paragraph">This package can be retrieved from <a href="https://bintray.com/relaycorp/maven/tech.relaycorp.poweb">JCenter</a>. For example, using the Gradle Groovy DSL:</p><div class="sample-container"><code class="" theme="idea"><pre>implementation 'tech.relaycorp:poweb:1.5.13'</pre></code></div><h2 class=""> Usage</h2><p class="paragraph">The first step is to generate and store the key pair that your private node will use on the network:</p><div class="sample-container"><code class="" theme="idea"><pre>val keyPair = generateRSAKeyPair()<br>securelyStorePrivateKey(keyPair.private)</pre></code></div><p class="paragraph">Next, initialize the client, which depends on the nature of your software:</p><ul><li><p class="paragraph">If it is a Relaynet-compatible app, you'll want to use <a href="tech.relaycorp.poweb/-po-web-client/-companion/init-local.html">tech.relaycorp.poweb.PoWebClient.initLocal</a>; e.g.:</p><div class="sample-container"><code class="" theme="idea"><pre>val client = PoWebClient.initLocal()</pre></code></div><p class="paragraph">Note: If you're building a Relaynet-compatible app for Android, use <a href="https://github.com/relaycorp/relaynet-endpoint-android">the endpoint library</a> instead as it offers a high-level interface to interact with the Android Gateway.</p></li><li><p class="paragraph">If it's a private gateway, like the <a href="https://github.com/relaycorp/relaynet-gateway-android">Android Gateway</a>, you'll want to connect to the public gateway using <a href="tech.relaycorp.poweb/-po-web-client/-companion/init-remote.html">tech.relaycorp.poweb.PoWebClient.initRemote</a>; e.g.:</p><div class="sample-container"><code class="" theme="idea"><pre>val client = PoWebClient.initRemote(&quot;poweb-frankfurt.relaycorp.cloud&quot;)</pre></code></div></li></ul><h3 class=""> Private node registration</h3><p class="paragraph">Per the PoWeb spec, before your private endpoint can exchange parcels with its gateway, it must register with it in order to get a certificate.</p><p class="paragraph">The registration step is preceded by a pre-registration that depends on the type of server you're connecting to. If you're connecting to a private gateway, the pre-registration process is determined by the private gateway implementation; for example, as of this writing, the Android Gateway uses a bound service. If you're connecting to a public gateway, to can pre-register using <a href="tech.relaycorp.poweb/-po-web-client/pre-register-node.html">tech.relaycorp.poweb.PoWebClient.preRegisterNode</a>; e.g.:</p><div class="sample-container"><code class="" theme="idea"><pre>val registrationRequest = client.preRegisterNode(keyPair.public)</pre></code></div><p class="paragraph">Once pre-registration is complete, you can complete the registration by passing the registration request <code>registrationRequest</code> to <a href="tech.relaycorp.poweb/-po-web-client/register-node.html">tech.relaycorp.poweb.PoWebClient.registerNode</a>. This registration request contains the registration authorization created by the server. For example, you may complete the registration as follows:</p><div class="sample-container"><code class="" theme="idea"><pre>val requestSerialized = registrationRequest.serialize(keyPair.private)<br>val registration = client.registerNode(requestSerialized)</pre></code></div><p class="paragraph">Finally, you can now store the certificates contained in the <a href="https://docs.relaycorp.tech/relaynet-jvm/api/relaynet/tech.relaycorp.relaynet.messages.control/-private-node-registration/index.html">registration</a>.</p><h3 class=""> Request signing</h3><p class="paragraph">Now that your private node is registered with its gateway, you have to use the certificate issued by its gateway and its corresponding private key to sign requests to exchange parcels. You can do so by initializing a signer and passing it to such requests; e.g.:</p><div class="sample-container"><code class="" theme="idea"><pre>val signer = Signer(registration.privateNodeCertificate, keyPair.private)</pre></code></div><h3 class=""> Delivering parcels</h3><p class="paragraph">Use <a href="tech.relaycorp.poweb/-po-web-client/deliver-parcel.html">tech.relaycorp.poweb.PoWebClient.deliverParcel</a> to deliver parcels to the gateway; e.g.:</p><div class="sample-container"><code class="" theme="idea"><pre>client.deliverParcel(parcelSerialized, signer)</pre></code></div><h3 class=""> Collecting parcels</h3><p class="paragraph">Use <a href="tech.relaycorp.poweb/-po-web-client/collect-parcels.html">tech.relaycorp.poweb.PoWebClient.collectParcels</a> to collect parcels from the gateway; e.g.:</p><div class="sample-container"><code class="" theme="idea"><pre>client.collectParcels(arrayOf(signer)).map {<br>    val parcel = it.deserializeAndValidateParcel()<br>    println(&quot;Parcel ${parcel.id} bound for ${parcel.recipientAddress} is valid&quot;)<br>    storeParcel(it.parcelSerialized)<br>    it.ack()<br>}</pre></code></div><h3 class=""> Closing the connection</h3><p class="paragraph">Make sure to close the connection by calling <a href="tech.relaycorp.poweb/-po-web-client/close.html">tech.relaycorp.poweb.PoWebClient.close</a> when you're done, or wrapping the statements using the client with a <code>.use</code> block as illustrated below:</p><div class="sample-container"><code class="" theme="idea"><pre>client.use {<br>    client.deliverParcel(parcelSerialized, signer)<br>}</pre></code></div></div></div>
          </div>
          <h2 class="">Packages</h2>
          <div class="table"><a data-name="%5Btech.relaycorp.poweb%2F%2F%2F%2FPointingToDeclaration%2F%5D%2FPackages%2F-1573829515" anchor-label="tech.relaycorp.poweb" id="%5Btech.relaycorp.poweb%2F%2F%2F%2FPointingToDeclaration%2F%5D%2FPackages%2F-1573829515" data-filterable-set=":dokkaHtml/main"></a>
            <div class="table-row" data-filterable-current=":dokkaHtml/main" data-filterable-set=":dokkaHtml/main">
              <div>
                <div class="main-subrow ">
                  <div class=""><span class="inline-flex"><a href="tech.relaycorp.poweb/index.html">tech.relaycorp.poweb</a><span class="anchor-wrapper"><span class="anchor-icon" pointing-to="%5Btech.relaycorp.poweb%2F%2F%2F%2FPointingToDeclaration%2F%5D%2FPackages%2F-1573829515"></span>
                        <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
                      </span></span></div>
                  <div class="pull-right"></div>
                </div>
                <div><span class="brief-comment"><a data-name="%5Btech.relaycorp.poweb%2F%2F%2F%2FPointingToDeclaration%2F%5D%2FPackages%2F-1573829515" anchor-label="tech.relaycorp.poweb" id="%5Btech.relaycorp.poweb%2F%2F%2F%2FPointingToDeclaration%2F%5D%2FPackages%2F-1573829515" data-filterable-set=":dokkaHtml/main"></a>This package contains the PoWeb client.</span></div>
              </div>
            </div>
          </div>
        </div>
        <div class="footer"><span class="go-to-top-icon"><a href="#content"></a></span><span>Â© 2020 Copyright</span><span class="pull-right"><span>Sponsored and developed by dokka</span><a href="https://github.com/Kotlin/dokka"><span class="padded-icon"></span></a></span></div>
      </div>
    </div>
  </body>
</html>

